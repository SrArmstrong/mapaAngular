<p-toast></p-toast>

<div class="grid">

    <div class="botones-container">
        <button pButton type="button" label="Ir al Login" icon="pi pi-user-shield" class="boton-inicio" (click)="IrInicio()"></button>
    </div>

    <!-- Mapa (columna de 8 en pantallas grandes) -->
    <div class="col-12 lg:col-8">
        <p-card styleClass="h-full mapa-card">

        <div class="map-container" style="position: relative; height: 500px;">
            
            <!-- Spinner de carga -->
            <div *ngIf="mapLoading" 
                class="flex align-items-center justify-content-center h-full">
            <div class="text-center">
                <p-progressSpinner strokeWidth="4" animationDuration="1s"></p-progressSpinner>
                <p class="text-600 mt-3">Cargando mapa...</p>
            </div>
            </div>

            <!-- Error de carga -->
            <div *ngIf="mapError" 
                class="flex align-items-center justify-content-center h-full">
            <div class="text-center">
                <i class="pi pi-exclamation-triangle text-red-500 text-4xl mb-3"></i>
                <p class="text-600">Error al cargar el mapa</p>
                <button pButton 
                label="Reintentar" 
                icon="pi pi-refresh"
                severity="secondary"
                (click)="ngAfterViewInit()">
                </button>
            </div>
            </div>

            <!-- Contenedor del mapa -->
            <div id="map" 
                [style.display]="mapLoading || mapError ? 'none' : 'block'"
                style="height: 100%; width: 100%; border-radius: 6px; z-index: 1;">
            </div>

        </div>
        </p-card>
    </div>

    <!-- Tabla para mostrar los paquetes -->
    <div class="tabla-container">
    <p-table [value]="paquetes" class="tabla-centrada">
        <ng-template pTemplate="header">
            <tr>
            <th>ID</th>
            <th>Direcci√≥n de entrega</th>
            <th>Estado</th>
            <th>Acciones</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-paquete>
            <tr>
            <td>{{ paquete.id }}</td>
            <td>{{ paquete.direccion }}</td>
            <td>{{ paquete.estado }}</td>
            <td>
                <button pButton 
                        icon="pi pi-check" 
                        label="Entregar" 
                        class="p-button-success"
                        (click)="entregarPaquete()">
                </button>
                <button pButton 
                        icon="pi pi-times" 
                        label="Cancelar" 
                        class="p-button-danger ml-2"
                        (click)="cancelarPaquete()">
                </button>
            </td>
            </tr>
        </ng-template>
    </p-table>
    </div>

</div>