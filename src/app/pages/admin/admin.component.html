<p-toast></p-toast>

<div class="grid">
    <div class="botones-container p-mb-4">
        <button pButton type="button" label="Ir al Login" icon="pi pi-sign-out" 
                class="p-button-danger" (click)="IrInicio()"></button>
        <button pButton type="button" label="Añadir paquete" icon="pi pi-plus" 
                class="p-button-success" (click)="showAddPackageDialog()"></button>
    </div>

    <!-- Diálogo para añadir paquete -->
    <p-dialog header="Añadir nuevo paquete" [(visible)]="displayAddPackageDialog" [style]="{width: '500px'}">
        <div class="p-fluid p-field">
            <label for="direccion">Dirección</label>
            <input id="direccion" type="text" pInputText [(ngModel)]="newPackage.direccion" 
                   placeholder="Ingrese la dirección del paquete">
        </div>
        
        <ng-template pTemplate="footer">
            <button pButton type="button" label="Cancelar" icon="pi pi-times" 
                    (click)="displayAddPackageDialog = false" class="p-button-text"></button>
            <button pButton type="button" label="Guardar" icon="pi pi-check" 
                    (click)="addPackage()"></button>
        </ng-template>
    </p-dialog>

    <!-- Diálogo para asignar paquetes -->
    <p-dialog header="Asignar paquetes a {{selectedDelivery?.username}}" [(visible)]="displayAssignDialog" 
              [style]="{width: '700px'}" [modal]="true">
        <p-table [value]="unassignedPackages" [paginator]="true" [rows]="5" [loading]="unassignedPackages.length === 0">
            <ng-template pTemplate="header">
                <tr>
                    <th>ID</th>
                    <th>Dirección</th>
                    <th>Estado</th>
                    <th>Acción</th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-package>
                <tr>
                    <td>{{ package.id }}</td>
                    <td>{{ package.direccion }}</td>
                    <td><p-tag [value]="package.estatus" [severity]="getStatusSeverity(package.estatus)"></p-tag></td>
                    <td>
                        <button pButton type="button" icon="pi pi-check" label="Asignar" 
                                (click)="assignPackage(package)" class="p-button-sm"></button>
                    </td>
                </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
                <tr>
                    <td colspan="4">No hay paquetes disponibles para asignar</td>
                </tr>
            </ng-template>
        </p-table>
    </p-dialog>

    <!-- Mapa y tabla de repartidores -->
    <div class="col-12 lg:col-8">
        <p-card header="Mapa de Repartidores" styleClass="h-full">
            <app-map [initialCoords]="[20.5888, -100.3899]" [deliveryLocations]="repartidoresUbicaciones" [initialZoom]="13"></app-map>
        </p-card>
    </div>

    <div class="col-12 lg:col-4">
        <p-card header="Lista de Repartidores">
            <p-table [value]="deliverys" [paginator]="true" [rows]="5">
                <ng-template pTemplate="header">
                    <tr>
                        <th>ID</th>
                        <th>Nombre</th>
                        <th>Estado</th>
                        <th>Acción</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-delivery>
                    <tr>
                        <td>{{ delivery.id }}</td>
                        <td>{{ delivery.username }}</td>
                        <td><p-tag [value]="delivery.state" [severity]="getDeliveryStatusSeverity(delivery.state)"></p-tag></td>
                        <td>
                            <button pButton type="button" icon="pi pi-box" label="Asignar" 
                                    (click)="showAssignDialog(delivery)" class="p-button-sm"></button>
                        </td>
                    </tr>
                </ng-template>
            </p-table>
        </p-card>
    </div>
</div>